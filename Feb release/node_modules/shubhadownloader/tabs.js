/********************************
	<Shubha Downloader, It downloads end of day pricing data from publicly available sites and converts it different formats....>
    Copyright (C) 2013 Shubhalabha.in

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program. If not, see <http://www.gnu.org/licenses/>
***********************************/
Ext.require('Ext.tab.*');


Ext.onReady(function(){
        			
    // basic tabs 1, built from existing content
    var tabs = Ext.widget('tabpanel', {
        renderTo: 'tabs1',
        id : 'tabpan',
        width: 720,
        height: 456,
        activeTab: 0,
        
        defaults :{
            bodyPadding: 10
        },
        items: [{
            contentEl:'hometab', 
            title: 'Home',
            iconCls: 'homeicon',
            closable: false
        },{
            contentEl:'productstab', 
            //id: 'productstab',
            title: 'Products',
            iconCls: 'producticon',
			closable: false
        },{
            contentEl:'settingstab', 
            title: 'Settings',
            //id: 'settingstab',
			iconCls: 'settingicon',
            closable: false,
			listeners: 
			{
				activate: function(tab) {
				//tab.loader.load();
				loadmask.show();
				setTimeout(function(){loadmask.hide();},1000);
				},
                                beforedeactivate: function(){
                                    var fs = require('fs');
                                    if(fs.existsSync('settings_flag.txt'))
                                    {
                                        fs.readFile('settings_flag.txt','utf-8',function(err, data){
                                            if(err){console.log(err.stack)}
                                            if(data != "" && data != null)
                                            {
                                                if(data.toString() == "saved")
                                                {
                                                    fs.writeFile('settings_flag.txt','notsaved',function(err){
                                                        if(err)console.log(err.stack);
                                                    });
                                                }else
                                                {
                                                    $("#msgSetting").slideDown(500);
                                                    setTimeout(function(){$("#msgSetting").slideUp(1000);},5000);
                                                    //Ext.getCmp('tabpan').getComponent(2).focus(true);
                                                    tabs.setActiveTab(2);
                                                 }
                                            }
                                        });
                                    }else
                                    {
                                        $("#msgSetting").slideDown(500);
                                        setTimeout(function(){$("#msgSetting").slideUp(1000);},5000);
                                        //Ext.getCmp('tabpan').getComponent(2).focus(true);
                                        tabs.setActiveTab(2);
                                    }
                                      
                                }
			}
        },{
            contentEl:'yahootab', 
            //id: 'yahootab',
            title: 'yahoo',
			iconCls: 'yahooicon',
            closable: false,
			listeners: 
			{
				activate: function(tab) {
				loadmask.show();
				setTimeout(function(){loadmask.hide();},1500);
				}
			}
        },
		{
            contentEl:'matab', 
            //id : 'matab',
            title: 'Market Analysis',
			iconCls: 'analysisicon',
			closable: false,
			listeners: 
			{
				activate: function(tab) {
				loadmask.show();
				setTimeout(function(){loadmask.hide();},1000);
				}
			}
        },{
            contentEl:'calendartab',
            //id : 'calendartab',
			iconCls: 'calendaricon',
            title: 'Calendar',
            closable: false,
			listeners: 
			{
				activate: function(tab) {
				loadmask.show();
				setTimeout(function(){loadmask.hide();},3000);
				}
			}
        },{
            contentEl:'contactustab', 
            //id : 'contactustab',
			iconCls: 'contacticon',
            title: 'Contact Us',
            listeners: 
			{
				activate: function(tab) {
				loadmask.show();
				setTimeout(function(){loadmask.hide();},1000);
				}
			},
            closable: false
        },{
            contentEl:'helptab', 
            //id : 'helptab',
            title: 'Help',
			//iconCls: 'helpicon',
            closable: false
        }]
    });
    
	var loadmask = new Ext.LoadMask(Ext.getBody(), {msg:"Loading..."});
	var async = require('async');
	var fs = require('fs');

	var csv = require('ya-csv');

	if(fs.existsSync('settings.csv'))
	{

	var reader = csv.createCsvFileReader('settings.csv',{'separator': ','});
	reader.addListener('data', function(data)
	{

	if(data[0]=='datafolder')
	{
	if(data[1] == "" || data[1] == " " || data[1] == null || data[1] == "undefined" || typeof data[1] == "undefined" )
	{
	tabs.setActiveTab(2);
	}
	}
	});
	}
	
});
