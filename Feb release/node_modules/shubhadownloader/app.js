var express = require("express")
  , passport = require("passport")
  , util = require("util")
  , YahooStrategy = require("passport-yahoo").Strategy;
var app = express();
passport.use(new YahooStrategy({
    returnURL: 'http://localhost:3000/auth/yahoo/return',
    realm: 'http://localhost:3000/'
  },
  function(identifier, done) {
    User.findByOpenID({ openId: identifier }, function (err, user) {
      return done(err, user);
    });
  }
));


app = express.createServer();
app.get('/auth/yahoo',
  passport.authenticate('yahoo'),
  function(req, res){
    // The request will be redirected to Yahoo for authentication, so
    // this function will not be called.
  });

app.get('/auth/yahoo/return',
  passport.authenticate('yahoo', { failureRedirect: '/login' }),
  function(req, res) {
    // Successful authentication, redirect home.
    res.redirect('/');
  });
  app.listen(3000);
  
	